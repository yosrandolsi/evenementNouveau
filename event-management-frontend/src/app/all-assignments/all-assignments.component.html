<div class="container-fluid py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3>
      <i class="bi bi-people-fill text-primary me-2"></i>
      Gestion des Affectations
    </h3>
    <button class="btn btn-outline-primary" (click)="refreshData()">
      <i class="bi bi-arrow-repeat"></i> Actualiser
    </button>
  </div>

  <!-- Filtres -->
  <div class="row mb-4">
    <div class="col-md-6 mb-2">
      <div class="input-group">
        <span class="input-group-text"><i class="bi bi-search"></i></span>
        <input type="text" class="form-control" placeholder="Rechercher staff, rôle ou événement..."
          [(ngModel)]="searchText" (input)="applyFilters()">
      </div>
    </div>
    <div class="col-md-4 mb-2">
      <select class="form-select" [(ngModel)]="roleFilter" (change)="applyFilters()">
        <option value="">Tous les rôles</option>
        <option *ngFor="let role of getUniqueRoles()" [value]="role">{{ role }}</option>
      </select>
    </div>
    <div class="col-md-2 mb-2">
      <button class="btn btn-primary w-100" (click)="applyFilters()">
        <i class="bi bi-funnel-fill"></i> Filtrer
      </button>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Chargement...</span>
    </div>
  </div>

  <!-- Liste en cartes -->
  <div *ngIf="!isLoading && filteredAssignments.length > 0" class="row g-3">
    <div class="col-md-6 col-lg-4" *ngFor="let assignment of filteredAssignments">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <div class="d-flex align-items-center mb-3">
            <img src="assets/avatar.png" class="rounded-circle me-3" width="50" height="50" alt="Avatar">
            <div>
              <h5 class="mb-0">{{ getUsername(assignment.userId) }}</h5>
              <small class="text-muted">
                <span class="badge rounded-pill" [ngClass]="{
                  'bg-primary': getOperationalRole(assignment.userId) === 'Manager',
                  'bg-success': getOperationalRole(assignment.userId) === 'Technician',
                  'bg-info': getOperationalRole(assignment.userId) === 'Coordinator',
                  'bg-warning': getOperationalRole(assignment.userId) === 'Supervisor',
                  'bg-secondary': true
                }">
                  {{ getOperationalRole(assignment.userId) }}
                </span>
              </small>
            </div>
          </div>

          <div>
            <h6 class="text-primary">{{ getEventTitle(assignment.eventId) }}</h6>
            <p class="mb-1 text-muted">
              <i class="bi bi-calendar"></i>
              {{ eventDetails[assignment.eventId]?.date || 'N/A' }}
            </p>
            <p class="text-muted mb-0">
              <i class="bi bi-geo-alt"></i>
              {{ eventDetails[assignment.eventId]?.location || 'N/A' }}
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Aucun résultat -->
  <div *ngIf="!isLoading && filteredAssignments.length === 0" class="alert alert-warning text-center mt-4">
    <i class="bi bi-exclamation-triangle me-2"></i>
    Aucune affectation trouvée pour ces critères
  </div>

  <!-- Footer -->
  <div class="mt-4 text-muted small text-end">
    Affichage de {{filteredAssignments.length}} affectation(s)
  </div>
</div>
